<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>redis å­¦ä¹ ç¬”è®° - çŒæˆ·åº§</title><meta name=Description content><meta property="og:title" content="redis å­¦ä¹ ç¬”è®°"><meta property="og:description" content="5 ç§åŸºæœ¬æ•°æ®ç»“æ„ è®¿é—®æ•°æ®éƒ½æ˜¯ K-V å½¢å¼ï¼Œæ‰€ä»¥è¿™é‡Œè¯´çš„æ•°æ®ç±»å‹éƒ½æ˜¯è¯´å€¼çš„ç±»å‹ã€‚ç„¶è€Œè¿è¡Œæ—¶ key æ˜¯å¯å˜çš„ï¼Œæ‰€è°“çš„ string ç”¨èµ·æ¥æ›´åƒ mapï¼Œæ‰€è°“çš„ hash ç±»å‹ç”¨èµ·æ¥æ›´"><meta property="og:type" content="article"><meta property="og:url" content="https://catplanet007.github.io/blog/posts/database/learning-redis/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-29T23:23:42+08:00"><meta property="article:modified_time" content="2020-11-29T23:23:42+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="redis å­¦ä¹ ç¬”è®°"><meta name=twitter:description content="5 ç§åŸºæœ¬æ•°æ®ç»“æ„ è®¿é—®æ•°æ®éƒ½æ˜¯ K-V å½¢å¼ï¼Œæ‰€ä»¥è¿™é‡Œè¯´çš„æ•°æ®ç±»å‹éƒ½æ˜¯è¯´å€¼çš„ç±»å‹ã€‚ç„¶è€Œè¿è¡Œæ—¶ key æ˜¯å¯å˜çš„ï¼Œæ‰€è°“çš„ string ç”¨èµ·æ¥æ›´åƒ mapï¼Œæ‰€è°“çš„ hash ç±»å‹ç”¨èµ·æ¥æ›´"><meta name=application-name content="çŒæˆ·åº§"><meta name=apple-mobile-web-app-title content="çŒæˆ·åº§"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://catplanet007.github.io/blog/posts/database/learning-redis/><link rel=next href=https://catplanet007.github.io/blog/posts/database/mysql-observability/><link rel=stylesheet href=/blog/lib/normalize/normalize.min.css><link rel=stylesheet href=/blog/css/style.min.css><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/blog/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"redis å­¦ä¹ ç¬”è®°","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/catplanet007.github.io\/blog\/posts\/database\/learning-redis\/"},"genre":"posts","keywords":"Redis","wordcount":3344,"url":"https:\/\/catplanet007.github.io\/blog\/posts\/database\/learning-redis\/","datePublished":"2020-11-29T23:23:42+08:00","dateModified":"2020-11-29T23:23:42+08:00","publisher":{"@type":"Organization","name":"catplanet"},"author":{"@type":"Person","name":"catplanet"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/blog/ title=çŒæˆ·åº§>çŒæˆ·åº§</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/posts/>æ–‡ç«  </a><a class=menu-item href=/blog/tags/>æ ‡ç­¾ </a><a class=menu-item href=/blog/categories/>åˆ†ç±» </a><a class=menu-item href=/blog/about/>å…³äº </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=çŒæˆ·åº§>çŒæˆ·åº§</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/blog/posts/ title>æ–‡ç« </a><a class=menu-item href=/blog/tags/ title>æ ‡ç­¾</a><a class=menu-item href=/blog/categories/ title>åˆ†ç±»</a><a class=menu-item href=/blog/about/ title>å…³äº</a><a href=javascript:void(0); class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>ç›®å½•</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">redis å­¦ä¹ ç¬”è®°</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=about/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>catplanet</a></span>&nbsp;<span class=post-category>æ”¶å½•äº <a href=/blog/categories/tech/><i class="far fa-folder fa-fw"></i>tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-11-29>2020-11-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 3344 å­—&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 7 åˆ†é’Ÿ&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>ç›®å½•</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#5-ç§åŸºæœ¬æ•°æ®ç»“æ„>5 ç§åŸºæœ¬æ•°æ®ç»“æ„</a><ul><li><a href=#string>string</a><ul><li><a href=#åˆ†å¸ƒå¼é”>åˆ†å¸ƒå¼é”</a></li></ul></li><li><a href=#list>list</a></li><li><a href=#hash>hash</a></li><li><a href=#set>set</a></li><li><a href=#zset>zset</a><ul><li><a href=#skiplist>skiplist</a></li></ul></li></ul></li><li><a href=#æŒä¹…åŒ–>æŒä¹…åŒ–</a><ul><li><a href=#rdb>RDB</a></li><li><a href=#aofappend-only-file>AOFï¼ˆAppend Only Fileï¼‰</a></li><li><a href=#æ··åˆæŒä¹…åŒ–>æ··åˆæŒä¹…åŒ–</a></li></ul></li><li><a href=#key-è¿‡æœŸç­–ç•¥>key è¿‡æœŸç­–ç•¥</a></li><li><a href=#å¯è§‚æµ‹æ€§>å¯è§‚æµ‹æ€§</a><ul><li><a href=#info-å‘½ä»¤>info å‘½ä»¤</a></li><li><a href=#slowlog>slowlog</a></li><li><a href=#latency>latency</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=5-ç§åŸºæœ¬æ•°æ®ç»“æ„>5 ç§åŸºæœ¬æ•°æ®ç»“æ„</h2><p>è®¿é—®æ•°æ®éƒ½æ˜¯ <strong>K-V</strong> å½¢å¼ï¼Œæ‰€ä»¥è¿™é‡Œè¯´çš„æ•°æ®ç±»å‹éƒ½æ˜¯è¯´<strong>å€¼</strong>çš„ç±»å‹ã€‚ç„¶è€Œè¿è¡Œæ—¶ key æ˜¯å¯å˜çš„ï¼Œæ‰€è°“çš„ <strong>string</strong> ç”¨èµ·æ¥æ›´åƒ <strong>map</strong>ï¼Œæ‰€è°“çš„ <strong>hash</strong> ç±»å‹ç”¨èµ·æ¥æ›´åƒåŒå±‚çš„ <strong>map</strong>ã€‚</p><p>æ‰€ä»¥å¦‚æœç”¨ä»£ç è°ƒç”¨ <strong>redis</strong>ï¼Œå¯ä»¥æ˜¯è¿™æ ·ï¼š</p><div class=highlight><pre class=chroma><code class=language-typescript data-lang=typescript><span class=kd>let</span> <span class=nx>key</span>: <span class=kt>string</span> <span class=o>=</span> <span class=sb>`user:name:1234`</span>
<span class=nx>redis</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Jack&#39;</span> <span class=c1>// set user:name:1234 Jack
</span><span class=c1></span><span class=kd>let</span> <span class=nx>userName</span>: <span class=kt>string</span> <span class=o>=</span> <span class=nx>redis</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span> <span class=c1>// get user:name:1234
</span><span class=c1></span>
<span class=nx>key</span> <span class=o>=</span> <span class=sb>`user:1234`</span>
<span class=nx>redis</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Jack&#39;</span><span class=p>}</span> <span class=c1>// hset user:1234 name Jack
</span><span class=c1></span><span class=nx>userName</span> <span class=o>=</span> <span class=nx>redis</span><span class=p>[</span><span class=nx>key</span><span class=p>].</span><span class=nx>name</span> <span class=c1>// hget user:1234 name
</span></code></pre></div><p>è€Œç»å¯¹ä¸èƒ½æ˜¯è¿™æ ·ï¼š</p><div class=highlight><pre class=chroma><code class=language-typescript data-lang=typescript><span class=kd>let</span> <span class=nx>userName1234</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;Jack&#39;</span> <span class=c1>// set user:name:1234 Jack
</span><span class=c1></span><span class=kd>let</span> <span class=nx>userName</span>: <span class=kt>string</span> <span class=o>=</span> <span class=nx>userName1234</span> <span class=c1>// get user:name:1234
</span><span class=c1></span>
<span class=kr>type</span> <span class=nx>hash</span> <span class=o>=</span> <span class=nx>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>string</span><span class=p>&gt;</span>
<span class=kd>let</span> <span class=nx>user1234</span>: <span class=kt>hash</span> <span class=o>=</span> <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Jack&#39;</span><span class=p>}</span> <span class=c1>// hset user:1234 name Jack
</span><span class=c1></span><span class=nx>userName</span> <span class=o>=</span> <span class=nx>user1234</span><span class=p>.</span><span class=nx>name</span> <span class=c1>// hget user:1234 name
</span></code></pre></div><h3 id=string>string</h3><p><strong>string</strong> æ˜¯å˜é•¿çš„ï¼Œä¼šé¢„å…ˆåˆ†é… <strong>capacity</strong>ï¼Œæœ€å¤§é•¿åº¦ 512Mã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; <span class=nb>set</span> name Jack
OK
&gt; get name
<span class=s2>&#34;Jack&#34;</span>
&gt; del name
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span> <span class=c1># 1: succeed</span>
&gt; get name
<span class=o>(</span>nil<span class=o>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; <span class=nb>set</span> name Jack
OK
&gt; expire name <span class=m>60</span> <span class=c1># 60s</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; ttl name
<span class=o>(</span>integer<span class=o>)</span> <span class=m>50</span>  <span class=c1># 50s to liveï¼Œ-1: hasn&#39;t set expire, -2: value not exist</span>
</code></pre></div><h4 id=åˆ†å¸ƒå¼é”>åˆ†å¸ƒå¼é”</h4><p><a href=http://www.redis.cn/commands/set.html target=_blank rel="noopener noreffer">set</a> å‘½ä»¤æä¾›çš„è¯­æ„ <code>func(key1 string, key2 string, expireInMilliseconds number, ifNotExist boolean) boolean</code>å¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ï¼š</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; <span class=nb>set</span> lock:user:123 xx-random-123 px <span class=m>10000</span> nx <span class=c1># è®¾ç½® 10s å¤±æ•ˆæ—¶é—´</span>
OK
&gt; <span class=nb>set</span> lock:user:123 xx-random-123 px <span class=m>10000</span> nx
<span class=o>(</span>nil<span class=o>)</span> <span class=c1># å¦‚æœ key å·²å­˜åœ¨ï¼Œä¸æ›´æ–°</span>
&gt; ttl lock:user:123
<span class=o>(</span>integer<span class=o>)</span> <span class=m>7</span>
</code></pre></div><p>æ•´ä¸ªæŒ‡ä»¤æ˜¯åŸå­çš„ï¼Œä¿è¯äº†åŠ é”å®‰å…¨ï¼Œè¶…æ—¶å¤±æ•ˆä¿è¯äº†åˆ†å¸ƒå¼åœºæ™¯ä¸‹ä¸å‘ç”Ÿæ­»é”ã€‚</p><p>éšæœºæ•° value æ˜¯ä¸ºäº†æ”¯æŒé‡Šæ”¾é”å®‰å…¨ï¼Œé‡Šæ”¾é”éœ€è¦ä½¿ç”¨ <strong>deleteIfValueEqual</strong> è¯­æ„ï¼Œé—æ†¾çš„æ˜¯ redis æ²¡æœ‰æä¾›è¿™æ ·çš„åŸå­å‘½ä»¤ï¼Œéœ€è¦ä½¿ç”¨ Lua è„šæœ¬å®ç°ï¼š</p><div class=highlight><pre class=chroma><code class=language-lua data-lang=lua><span class=kr>if</span> <span class=n>redis.call</span><span class=p>(</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=n>KEYS</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>==</span> <span class=n>ARGV</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=kr>then</span>
    <span class=kr>return</span> <span class=n>redis.call</span><span class=p>(</span><span class=s2>&#34;del&#34;</span><span class=p>,</span><span class=n>KEYS</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=kr>else</span>
    <span class=kr>return</span> <span class=mi>0</span>
<span class=kr>end</span>
</code></pre></div><p>è¿™ç§æ–¹å¼åªèƒ½é’ˆå¯¹å•å®ä¾‹çš„ redisï¼Œå¦‚æœ redis å˜æˆä¸»ä»ç»“æ„ï¼Œç”±äº redis ä¸»ä»åŒæ­¥é€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼Œé”ä¸å†å®‰å…¨ã€‚å¯¹äº redis é›†ç¾¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href=http://www.redis.cn/topics/distlock.html target=_blank rel="noopener noreffer">Redlock ç®—æ³•</a>ï¼Œåªæœ‰ä»è¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹æˆåŠŸè®¾ç½® key æ‰ç®—åŠ é”æˆåŠŸã€‚</p><h3 id=list>list</h3><p>å®ç°é‡‡ç”¨åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥ä¼˜å…ˆä½¿ç”¨ <code>push</code>/<code>pop</code>ï¼Œå°‘ç”¨ä¸‹æ ‡è®¿é—®ã€‚</p><p>å…ƒç´ è¾ƒå°‘æ—¶ä½¿ç”¨ <strong>ziplist</strong>ï¼Œä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼›å…ƒç´ æ•™å¤šæ—¶ä½¿ç”¨ <strong>quicklist</strong>ï¼Œå³å°†å¤šä¸ª <strong>ziplist</strong> è¿èµ·æ¥çš„é“¾è¡¨ã€‚è¿™æ ·é¿å…äº†å¤šä¸ª <code>next/pre</code> æŒ‡é’ˆå¯¹å†…å­˜çš„æ¶ˆè€—ã€‚</p><p><img class=lazyload src=/blog/svg/loading.min.svg data-src=/blog/tech/redis/quicklist.svg data-srcset="/blog/tech/redis/quicklist.svg, /blog/tech/redis/quicklist.svg 1.5x, /blog/tech/redis/quicklist.svg 2x" data-sizes=auto alt=/blog/tech/redis/quicklist.svg title=quicklist></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; rpush myList aaa
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span> <span class=c1># [&#34;aaa&#34;]</span>
&gt; rpush myList bbb ccc ddd
<span class=o>(</span>integer<span class=o>)</span> <span class=m>4</span> <span class=c1># [&#34;aaa&#34;, &#34;bbb&#34;, &#34;ccc&#34;, &#34;ddd&#34;]</span>
&gt; lpush myList xxx yyy
<span class=o>(</span>integer<span class=o>)</span> <span class=m>6</span> <span class=c1># [&#34;yyy&#34;, &#34;xxx&#34;, &#34;aaa&#34;, &#34;bbb&#34;, &#34;ccc&#34;, &#34;ddd&#34;]</span>
&gt; lpop myList
<span class=s2>&#34;yyy&#34;</span>
&gt; lpop myList
<span class=s2>&#34;xxx&#34;</span>
&gt; lpop myList
<span class=s2>&#34;aaa&#34;</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; llen myList
<span class=o>(</span>integer<span class=o>)</span> <span class=m>3</span>
&gt; lindex myList <span class=m>1</span> <span class=c1># ä» 0 å¼€å§‹</span>
<span class=s2>&#34;ccc&#34;</span>
&gt; lrange myList <span class=m>0</span> <span class=m>0</span> <span class=c1># [left, right]</span>
1<span class=o>)</span> <span class=s2>&#34;bbb&#34;</span>
&gt; lrange myList <span class=m>0</span> -1
1<span class=o>)</span> <span class=s2>&#34;bbb&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;ccc&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;ddd&#34;</span>
&gt; lset myList <span class=m>1</span> ccc2 <span class=c1># ä¿®æ”¹å…ƒç´ </span>
OK
&gt; lrange myList <span class=m>0</span> -1
1<span class=o>)</span> <span class=s2>&#34;bbb&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;ccc2&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;ddd&#34;</span>
&gt; lrem myList <span class=m>1</span> ccc2 <span class=c1># åˆ é™¤å€¼ä¸ºæŒ‡å®šå€¼çš„å‰ count ä¸ªå…ƒç´ </span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
</code></pre></div><h3 id=hash>hash</h3><p>æ— åºå­—å…¸ï¼Œå®ç°é‡‡ç”¨æ•°ç»„+é“¾è¡¨ï¼Œhash åˆ°æ•°ç»„å‘ç”Ÿç¢°æ’æ—¶ä½¿ç”¨é“¾è¡¨ã€‚å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚rehash æ˜¯æ¸è¿›å¼çš„ï¼Œä¿ç•™æ–°æ—§ä¸¤ä¸ª hash ç»“æ„ï¼ŒæŸ¥è¯¢æ—¶ä¼šåŒæ—¶æŸ¥è¯¢ä¸¤ä¸ª hash ç»“æ„ï¼Œç›´åˆ°æœ€åå°†æ—§ hash çš„å†…å®¹éƒ½è¿ç§»åˆ°æ–°çš„ hash ç»“æ„ä¸­æ‰ä¼šåˆ é™¤æ—§ hashã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; hset myHash k1 v1
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; hset myHash k2 v2 k3 v3 <span class=c1># å•æ¬¡è®¾ç½®å¤šä¸ª key</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>2</span>
&gt; hget myHash k1
<span class=s2>&#34;v1&#34;</span>
&gt; hmget myHash k1 k2
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
&gt; hgetall myHash
1<span class=o>)</span> <span class=s2>&#34;k1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;k2&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;k3&#34;</span>
6<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
&gt; hkeys myHash
1<span class=o>)</span> <span class=s2>&#34;k1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;k2&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;k3&#34;</span>
&gt; hvals myHash
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
&gt; hdel myHash k1 k3 <span class=c1># æ”¯æŒåŒæ—¶åˆ é™¤å¤šä¸ª key</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>2</span>
</code></pre></div><h3 id=set>set</h3><p>æ— åºé›†åˆï¼Œå®ç°å’Œ <strong>hash</strong> ä¸€æ ·ï¼Œåªä¸è¿‡ <strong>value</strong> éƒ½æ˜¯ <code>null</code>ã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; sadd mySet v1 v2 v3
<span class=o>(</span>integer<span class=o>)</span> <span class=m>3</span>
&gt; smembers mySet
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
&gt; scard mySet <span class=c1># æŸ¥çœ‹é›†åˆå¤§å°</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>3</span>
&gt; srandmember mySet <span class=m>2</span> <span class=c1># éšæœºè·å– 2 ä¸ªå…ƒç´ ï¼Œé»˜è®¤ä¸º1ï¼Œè¶…è¿‡é›†åˆå¤§å°åªè¿”å›å…¨éƒ¨å…ƒç´ </span>
<span class=s2>&#34;v3&#34;</span>
&gt; srem mySet v1 v2
<span class=o>(</span>integer<span class=o>)</span> <span class=m>2</span>
&gt; spop mySet <span class=c1># éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ </span>
<span class=s2>&#34;v3&#34;</span>
</code></pre></div><h3 id=zset>zset</h3><p>åŠ æƒ Setï¼ŒæŒ‰ç…§æƒé‡ <strong>score</strong> æ’åºã€‚å®ç°é‡‡ç”¨ <strong>hash</strong> + <strong>skiplist</strong>ã€‚</p><p>zset æ”¯æŒçš„æ˜¯ <strong>(key, score, idx)</strong> ä¸‰å…ƒç»„çš„äº’ç›¸è®¿é—®ï¼Œé¦–å…ˆæ˜¯ä¸ªæœ‰åº Mapï¼Œå…ƒç´ é¡ºåºæ˜¯ score ä»å°åˆ°å¤§çš„é¡ºåºï¼Œå…¶æ¬¡æ”¯æŒæ ¹æ® score/idx èŒƒå›´å– keyã€‚</p><ul><li>æ ¹æ® key è®¿é—®ï¼Œç”¨ <strong>hash</strong> å®ç°<ul><li><a href=http://www.redis.cn/commands/zscore.html target=_blank rel="noopener noreffer">zscore</a>ï¼š<code>func(key) score</code></li><li><a href=http://www.redis.cn/commands/zrank.html target=_blank rel="noopener noreffer">zrank</a>ï¼š<code>func(key) idx</code></li></ul></li><li>æ ¹æ® score è®¿é—®ï¼Œç”¨ <strong>skiplist</strong> å®ç°<ul><li><a href=http://www.redis.cn/commands/zrangebyscore.html target=_blank rel="noopener noreffer">zrangebyscore</a>ï¼š<code>func(minScore, maxScore) []&lt;key,score></code></li></ul></li><li>æ ¹æ® idx è®¿é—®ï¼Œç”¨ç¨åŠ ä¿®æ”¹çš„ <strong>skiplist</strong> æ¥å®ç°<ul><li><a href=http://www.redis.cn/commands/zrange.html target=_blank rel="noopener noreffer">zrange</a>ï¼š<code>func(minIdx, maxIdx) []&lt;key,score></code></li><li><a href=http://www.redis.cn/commands/zrevrange.html target=_blank rel="noopener noreffer">zrevrange</a>ï¼š<code>func(minIdx, maxIdx) []&lt;key,score></code></li></ul></li></ul><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; zadd myZset <span class=m>1</span> v1
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; zadd myZset <span class=m>2</span> v2
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; zadd myZset <span class=m>3</span> v3
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; zrange myZset <span class=m>0</span> -1 <span class=c1># æŒ‰ score é¡ºåºè¾“å‡º</span>
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
&gt; zrevrange myZset <span class=m>0</span> -1 <span class=c1># æŒ‰ score é€†åºè¾“å‡º</span>
1<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
&gt; zcard myZset <span class=c1># len(myZset)</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>3</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; zadd myZset 4.44 v4
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; zscore myZset v4 <span class=c1># æ ¹æ® key è·å– score</span>
<span class=s2>&#34;4.4400000000000004&#34;</span>
&gt; zrank myZset v4 <span class=c1># è·å– key å¯¹åº”çš„æ’åï¼Œä» 0 å¼€å§‹è®¡ç®—</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>3</span>
&gt; zrangebyscore myZset <span class=m>1</span> <span class=m>2</span> <span class=c1># æ ¹æ® score é—­åŒºé—´è·å– key</span>
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
&gt; zrangebyscore myZset -inf <span class=m>3</span> withscores <span class=c1># éå†(-âˆ, 8.91]è¿”å› key å’Œ score</span>
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;1&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;v2&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;2&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
6<span class=o>)</span> <span class=s2>&#34;3&#34;</span>
&gt; zrem myZset v2 <span class=c1># åˆ é™¤ key</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
&gt; zrange myZset <span class=m>0</span> -1
1<span class=o>)</span> <span class=s2>&#34;v1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;v3&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;v4&#34;</span>
</code></pre></div><h4 id=skiplist>skiplist</h4><p>zset æ”¯æŒéšæœºå†™å…¥ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ•°ç»„ã€‚éšæœºå†™å…¥å¯ä»¥è€ƒè™‘ç”¨é“¾è¡¨ï¼Œä½†æ˜¯å¦‚ä½•ç¡®è®¤ä»å“ªä¸ªèŠ‚ç‚¹å†™å…¥å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ skiplistï¼Œå…¶æŸ¥æ‰¾åœ¨å“ªä¸ªèŠ‚ç‚¹å†™å…¥çš„è¿‡ç¨‹ç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾ã€‚</p><p>skiplist ç»“æ„å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å¤šæ¡é“¾è¡¨ç»„åˆèµ·æ¥ï¼š</p><ol><li>æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç…§ score å¤§å°ç»„æˆä¸€æ¡å•å‘é“¾è¡¨ï¼Œç§°ä¹‹ä¸ºç¬¬1å±‚é“¾è¡¨</li><li>ç»´æŒç¬¬1å±‚é“¾è¡¨ç»“æ„ä¸å˜ï¼Œä»ä¸­éšæœºæŒ‘é€‰50%èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ç»„æˆä¸€æ¡æ–°çš„å•å‘é“¾è¡¨ï¼Œç§°ä¹‹ä¸ºç¬¬2å±‚é“¾è¡¨</li><li>ç»´æŒç¬¬2å±‚é“¾è¡¨ç»“æ„ä¸å˜ï¼Œä»ä¸­éšæœºæŒ‘é€‰50%èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ç»„æˆä¸€æ¡æ–°çš„å•å‘é“¾è¡¨ï¼Œç§°ä¹‹ä¸ºç¬¬3å±‚é“¾è¡¨</li><li>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æˆ‘ä»¬è®¾å®šçš„æœ€å¤§ä¸€å±‚ï¼Œä¾‹å¦‚ redis ä¸­æ˜¯64å±‚</li></ol><p>è¿™æ ·æœ€åä¼šç»„æˆè¿™æ ·ä¸€ä¸ªç»“æ„ï¼š</p><p><img class=lazyload src=/blog/svg/loading.min.svg data-src=/blog/tech/redis/skiplist.svg data-srcset="/blog/tech/redis/skiplist.svg, /blog/tech/redis/skiplist.svg 1.5x, /blog/tech/redis/skiplist.svg 2x" data-sizes=auto alt=/blog/tech/redis/skiplist.svg title=skiplist></p><p>éœ€è¦æ³¨æ„çš„æ˜¯å›¾ä¸­â€œèŠ‚ç‚¹35â€çœ‹ä¼¼æœ‰å¤šä¸ªï¼Œå…¶å®åªæœ‰ä¸€ä¸ªï¼Œåœ¨å†…å­˜ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ªåœ°å€ï¼Œåªä¸è¿‡å®ƒéš¶å±å¤šä¸ªé“¾è¡¨ã€‚</p><p>å‡è®¾ç°åœ¨è¦æ’å…¥â€œèŠ‚ç‚¹80â€ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®å°±å’Œå¯„å¿«é€’ä¸€æ ·ï¼š</p><ul><li>å…ˆæŸ¥å›½å®¶ï¼ˆç¬¬5å±‚é“¾è¡¨ï¼‰ï¼Œå‘ç° 80 > 60ï¼Œæ‰€ä»¥ insertAt âˆˆ (80, TAIL)</li><li>å†æŸ¥çœå¸‚ï¼ˆç¬¬4å±‚é“¾è¡¨ï¼‰ï¼Œå‘ç° 80 > 60ï¼Œæ‰€ä»¥ insertAt âˆˆ (80, TAIL)</li><li>å†æŸ¥åŒºï¼ˆç¬¬3å±‚é“¾è¡¨ï¼‰ï¼Œå‘ç° 80 &lt; 91ï¼Œæ‰€ä»¥ insertAt âˆˆ (80, 91)</li><li>å†æŸ¥è¡—é“ï¼ˆç¬¬2å±‚é“¾è¡¨ï¼‰ï¼Œå‘ç° 80 > 75ï¼Œæ‰€ä»¥ insertAt âˆˆ (75, 91)</li><li>å†æŸ¥é—¨ç‰Œå·ç ï¼ˆç¬¬1å±‚é“¾è¡¨ï¼‰ï¼Œå‘ç° 80 &lt; 83ï¼Œæ‰€ä»¥ insertAt âˆˆ (75, 83)ï¼Œä¹Ÿå°±æ˜¯æ’å…¥åˆ°â€œèŠ‚ç‚¹75â€åé¢</li></ul><p>æ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œå¦‚ä½•ç¡®å®šâ€œèŠ‚ç‚¹80â€å±äºå‡ å±‚é“¾è¡¨å‘¢ï¼Ÿè¿™é‡Œè¿˜æ˜¯é‡‡ç”¨ç›¸åŒæ–¹å¼ï¼Œé¦–å…ˆæ–°èŠ‚ç‚¹å¿…ç„¶å±äºç¬¬ä¸€å±‚ï¼Œç„¶åæ¯æƒ³æ™‹å‡1å±‚ï¼Œéƒ½è¦æŠ›ä¸€ä¸‹ç¡¬å¸ï¼Œé€šè¿‡æ‰èƒ½æ™‹å‡ï¼Œåªè¦æ™‹å‡æˆåŠŸå°±å¯ä»¥ä¸€ç›´æ™‹å‡ï¼Œç›´åˆ°æ™‹å‡å¤±è´¥æˆ–è€…æ™‹å‡åˆ°æœ€é«˜å±‚ä¸ºæ­¢ã€‚æ’å…¥æ–°èŠ‚ç‚¹å¹¶ä¸å½±å“æ—§èŠ‚ç‚¹çš„å±‚æ•°ï¼Œåªéœ€è¦å°†å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆé‡æ–°æŒ‡å‘ä¸€ä¸‹å°±è¡Œäº†ï¼Œå¯ä»¥çœ‹åˆ°ç»Ÿè®¡ä¸Šæ’å…¥æ€§èƒ½ä¸ä¾èµ–èŠ‚ç‚¹æ’å…¥é¡ºåºã€‚</p><p>ç†è§£äº† skiplist çš„åŸç†åï¼Œæˆ‘ä»¬å¯ä»¥å» <a href=https://leetcode-cn.com/problems/design-skiplist/ target=_blank rel="noopener noreffer">leetcode è®¾è®¡è·³è·ƒè¡¨é—®é¢˜</a> å®ç°ä¸€ä¸‹è¿‡æŠŠç˜¾äº†ï¼Œæ¯•ç«Ÿæœ‰äººæå‰å¸®ä½ å†™å¥½äº†å•å…ƒæµ‹è¯•äº†ğŸ˜‰</p><p>skiplist æ’å…¥çš„å¹³å‡å¤æ‚åº¦æ˜¯ <em>O(log n)</em>ï¼Œè¯¦ç»†çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥å‚è€ƒè®ºæ–‡ <a href=https://15721.courses.cs.cmu.edu/spring2018/papers/08-oltpindexes1/pugh-skiplists-cacm1990.pdf target=_blank rel="noopener noreffer">Skip Lists: A Probabilistic Alternative to Balanced Trees</a>ã€‚</p><p>redis ä¸­å®ç°çš„ skiplist ç¨å¾®æœ‰äº›åŒºåˆ«ï¼Œä¾‹å¦‚ä¸Šé¢æˆ‘ä»¬ä¸€ç›´æŠŠæ™‹å‡æ¦‚ç‡è®¾ç½®ä¸º50%ï¼Œredis ä¸­é‡‡ç”¨çš„æ˜¯25%ï¼›redis ä¸­ skiplist ç»´æŠ¤äº†æ¯ä¸ªèŠ‚ç‚¹å’Œä¸Šä¸ªèŠ‚ç‚¹çš„è·ç¦»ï¼Œç”¨æ¥å®ç° zrankï¼Œè¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ <em>O(log n)</em>ï¼›æ­¤å¤–ç¬¬1å±‚é“¾è¡¨æ˜¯åŒå‘é“¾è¡¨ï¼Œç”¨æ¥å®ç°åå‘éå†ã€‚</p><h2 id=æŒä¹…åŒ–>æŒä¹…åŒ–</h2><h3 id=rdb>RDB</h3><ul><li>æ”¯æŒå°†å½“å‰å†…å­˜ä¸­æ•°æ® dump åˆ°ç¡¬ç›˜ä¸­ä¸º dump.rdb æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <a href=https://github.com/sripathikrishnan/redis-rdb-tools target=_blank rel="noopener noreffer">redis-rdb-tools</a> æŸ¥çœ‹å…¶ä¸­å†…å®¹</li><li>æ”¯æŒæŒ‡å®šæ—¶é—´é—´éš”å®šæœŸä¿å­˜ snapshot</li><li>ä¿å­˜ RDB æ–‡ä»¶æ—¶ä¼š fork ä¸€ä¸ªå­è¿›ç¨‹ï¼ŒIO æ“ä½œå…¨åœ¨å­è¿›ç¨‹å†…åšï¼Œç”± linux çš„å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æœºåˆ¶ä¿è¯æ•°æ®æ˜¯ <a href=http://www.redis.cn/commands/save.html target=_blank rel="noopener noreffer">save</a> å‘½ä»¤é‚£ä¸€åˆ»çš„æ•°æ®</li><li>ä¸ AOFï¼Œæ¢å¤å¤§é‡æ•°æ®æ—¶ï¼ŒRDB æ–¹å¼æ›´å¿«</li><li>ç”±äºæ˜¯å®šæœŸä¿å­˜ï¼Œæ‰€ä»¥ RDB æ–¹å¼å¯èƒ½ä¸¢å¤±æœ€è¿‘å‡ åˆ†é’Ÿæ•°æ®</li></ul><h3 id=aofappend-only-file>AOFï¼ˆAppend Only Fileï¼‰</h3><ul><li>AOF æ—¥å¿—ä¸­æ˜¯ reids æœåŠ¡å™¨æŒ‰é¡ºåºçš„æ‰€æœ‰å†™æ“ä½œæŒ‡ä»¤å½•åˆ¶ã€‚</li><li>æ¯æ¡å†™æ“ä½œæŒ‡ä»¤ä¼šè¢«è¿½åŠ åˆ° <code>aof_buf</code> ä¸­ï¼Œé»˜è®¤æ¯éš”1sæ‰§è¡Œä¸€æ¬¡ <code>fsync</code> å°†æ•°æ®å†™å…¥ AOF æ–‡ä»¶ï¼Œå´©æºƒåæœ€å¤šä¸¢å¤±1sçš„æ•°æ®ã€‚</li></ul><h3 id=æ··åˆæŒä¹…åŒ–>æ··åˆæŒä¹…åŒ–</h3><p>redis 4.0 ä»¥åæ”¯æŒäº† RDB å’Œå¢é‡ AOF æ–‡ä»¶å­˜åœ¨ä¸€èµ·ï¼Œä¹…è¿œå†å²æ•°æ®å­˜ RDBï¼Œæœ€è¿‘æ•°æ®ç”¨å­˜ AOFã€‚</p><h2 id=key-è¿‡æœŸç­–ç•¥>key è¿‡æœŸç­–ç•¥</h2><p>redis æœ‰2ç§æ–¹å¼è®©åˆ é™¤è¿‡æœŸ keyï¼š<strong>å®šæœŸåˆ é™¤</strong>å’Œ<strong>æƒ°æ€§åˆ é™¤</strong>ã€‚</p><p>redis ä¼šå®šæœŸï¼ˆæ¯ç§’10æ¬¡ï¼‰æ‰«æåˆ é™¤è¿‡æœŸçš„ key</p><ol><li>éšæœºå– 20 ä¸ª key</li><li>åˆ é™¤ 20 ä¸ª key ä¸­è¿‡æœŸçš„ key</li><li>å¦‚æœè¿™ 20 ä¸ª key ä¸­è¿‡æœŸ key å æ¯” > 25%ï¼ˆ5 ä¸ªï¼‰ï¼Œé‚£ä¹ˆé‡å¤æ­¥éª¤ 1</li></ol><p>æœ‰äº†è¿™ä¸ªç­–ç•¥ï¼Œé€šå¸¸ä¸ä¼šæœ‰è¶…è¿‡ 25% çš„è¿‡æœŸ keyã€‚åŒæ—¶ä¸ºäº†é˜²æ­¢è¿‡åº¦å ç”¨ cpuï¼Œé™åˆ¶å•æ¬¡æ‰«ææ—¶é—´ä¸è¶…è¿‡ 25msã€‚å¦‚æœåŒæ—¶æœ‰å¤§é‡ key åŒæ—¶è¿‡æœŸï¼Œå¤§é‡ key åŒæ—¶å›æ”¶ä¼šå¯¼è‡´å¤„ç†è¯»å†™è¯·æ±‚æœ‰å»¶è¿Ÿã€‚æ‰€ä»¥å¦‚æœæœ‰å¤§æ‰¹é‡ key è¿‡æœŸï¼Œè¦ç»™è¿‡æœŸæ—¶é—´ä¸€ä¸ªéšæœºèŒƒå›´ï¼Œä¸è¦éƒ½åœ¨åŒä¸€ä¸ªæ—¶é—´å†…è¿‡æœŸã€‚</p><p>åŒæ—¶ä¸ºäº†ä¿è¯å‡†ç¡®ï¼Œè¿˜æœ‰æƒ°æ€§åˆ é™¤ï¼Œè®¿é—® key æ—¶æ£€æŸ¥ key æ˜¯å¦è¿‡æœŸéœ€è¦åˆ é™¤ã€‚</p><p>å½“æŸä¸ª key é€šè¿‡ä¸Šè¿°ç­–ç•¥è¢«åˆ é™¤æ—¶ï¼Œredis ä¼šåŒæ—¶å‘ AOF ä¸­åŠ å…¥ä¸€æ¡ <a href=http://www.redis.cn/commands/del.html target=_blank rel="noopener noreffer">del</a> è¯­å¥ã€‚</p><h2 id=å¯è§‚æµ‹æ€§>å¯è§‚æµ‹æ€§</h2><h3 id=info-å‘½ä»¤>info å‘½ä»¤</h3><p><a href=http://www.redis.cn/commands/info.html target=_blank rel="noopener noreffer">info</a> å‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ redis æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€ã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># operations per secondï¼Œæ¯ç§’å¤šå°‘æ¬¡æŒ‡ä»¤</span>
$ redis-cli info stats <span class=p>|</span> grep ops
instantaneous_ops_per_sec:789

<span class=c1># å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯æ•°</span>
$ redis-cli info clients <span class=p>|</span> grep connect
connected_clients:2

<span class=c1># å†…å­˜å ç”¨</span>
$ redis-cli info memory <span class=p>|</span> grep used <span class=p>|</span> grep human
used_memory_human:841.13K <span class=c1># å†…å­˜åˆ†é…å™¨ (jemalloc) ä»æ“ä½œç³»ç»Ÿåˆ†é…çš„å†…å­˜æ€»é‡</span>
used_memory_rss_human:3.90M  <span class=c1># æ“ä½œç³»ç»Ÿçœ‹åˆ°çš„å†…å­˜å ç”¨ï¼Œtop å‘½ä»¤çœ‹åˆ°çš„å†…å­˜</span>
used_memory_peak_human:842.16K  <span class=c1># redis å†…å­˜æ¶ˆè€—çš„å³°å€¼</span>
used_memory_lua_human:37.00K <span class=c1># lua è„šæœ¬å¼•æ“å ç”¨çš„å†…å­˜å¤§å°</span>

<span class=c1># ä¸»ä»å¤åˆ¶çš„ç§¯å‹ç¼“å†²åŒºå¤§å°</span>
$ redis-cli info replication <span class=p>|</span> grep backlog
repl_backlog_active:0
repl_backlog_size:1048576 <span class=c1># ç§¯å‹ç¼“å†²åŒºå¤§å°</span>
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0https://github.com/sripathikrishnan/redis-rdb-tools
</code></pre></div><h3 id=slowlog>slowlog</h3><p>redis è®°å½•äº†æ‰§è¡Œæ—¶é—´è¶…è¿‡ç»™å®šæ—¶é•¿çš„å‘½ä»¤è¯·æ±‚ã€‚
redis æä¾›äº†2ä¸ªé…ç½®ï¼š</p><ul><li><code>slowlog-log-slower-than</code>ï¼šå‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼ˆä¸åŒ…æ‹¬æ’é˜Ÿæ—¶é—´ï¼‰è¶…è¿‡è¯¥æ—¶é—´æ—¶ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå•ä½ä¸ºå¾®ç§’ã€‚</li><li><code>slowlog-max-len</code>ï¼šå¯ä»¥è®°å½•çš„æ…¢æŸ¥è¯¢å‘½ä»¤çš„æ€»æ•°ã€‚</li></ul><p>é€šè¿‡ <a href=http://www.redis.cn/commands/slowlog.html target=_blank rel="noopener noreffer">slowlog</a> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ…¢æŸ¥è¯¢ï¼š</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>&gt; slowlog get <span class=m>2</span>
1<span class=o>)</span> 1<span class=o>)</span> <span class=o>(</span>integer<span class=o>)</span> <span class=m>14</span> <span class=c1># æ…¢æŸ¥è¯¢è‡ªå¢ id</span>
   2<span class=o>)</span> <span class=o>(</span>integer<span class=o>)</span> <span class=m>1309448221</span> <span class=c1># æ…¢æŸ¥è¯¢æ‰§è¡Œ unix æ—¶é—´</span>
   3<span class=o>)</span> <span class=o>(</span>integer<span class=o>)</span> <span class=m>15</span> <span class=c1># è€—æ—¶å¾®ç§’</span>
   4<span class=o>)</span> 1<span class=o>)</span> <span class=s2>&#34;ping&#34;</span>
2<span class=o>)</span> 1<span class=o>)</span> <span class=o>(</span>integer<span class=o>)</span> <span class=m>13</span>
   2<span class=o>)</span> <span class=o>(</span>integer<span class=o>)</span> <span class=m>1309448128</span>
   3<span class=o>)</span> <span class=o>(</span>integer<span class=o>)</span> <span class=m>30</span>
   4<span class=o>)</span> 1<span class=o>)</span> <span class=s2>&#34;slowlog&#34;</span>
      2<span class=o>)</span> <span class=s2>&#34;get&#34;</span>
      3<span class=o>)</span> <span class=s2>&#34;100&#34;</span>
&gt; slowlog reset <span class=c1># æ¸…ç©ºæ…¢æŸ¥è¯¢</span>
</code></pre></div><h3 id=latency>latency</h3><p>è¿™é‡Œçš„ latency æŒ‡å®¢æˆ·ç«¯çš„ï¼Œé€šè¿‡ &ndash;latency å¯ä»¥æŸ¥çœ‹å®¢æˆ·ç«¯å»¶è¿Ÿã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ redis-cli --latency
min: 0, max: 1, avg: 0.19 <span class=o>(</span><span class=m>187</span> samples<span class=o>)</span>
</code></pre></div><p>å…³äºå¦‚ä½•æ’æŸ¥é«˜ latency å¯ä»¥å‚è€ƒ <a href=https://redis.io/topics/latency target=_blank rel="noopener noreffer">Redis latency problems troubleshooting</a>ï¼Œè¿™é‡Œæœ‰<a href="https://www.oschina.net/translate/redis-latency-problems-troubleshooting?lang=chs&p=1" target=_blank rel="noopener noreffer">ä¸­æ–‡ç‰ˆ</a>ã€‚</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>æ›´æ–°äº 2020-11-29</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/blog/tags/redis/>Redis</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>è¿”å›</a></span>&nbsp;|&nbsp;<span><a href=/blog/>ä¸»é¡µ</a></span></section></div><div class=post-nav><a href=/blog/posts/database/mysql-observability/ class=next rel=next title="å­¦ä¹ è§‚æµ‹ MySQL">å­¦ä¹ è§‚æµ‹ MySQL<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>ç”± <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.84.4">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=about/ target=_blank>catplanet</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=å›åˆ°é¡¶éƒ¨><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=æŸ¥çœ‹è¯„è®º><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/blog/lib/katex/katex.min.css><link rel=stylesheet href=/blog/lib/katex/copy-tex.min.css><script type=text/javascript src=/blog/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/blog/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/blog/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/blog/lib/katex/katex.min.js></script><script type=text/javascript src=/blog/lib/katex/auto-render.min.js></script><script type=text/javascript src=/blog/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/blog/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"å¤åˆ¶åˆ°å‰ªè´´æ¿",maxShownLines:100},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/blog/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-186389448-1')</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-186389448-1" async></script></body></html>